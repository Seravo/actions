---
name: 'Build Docker image'
description: 'Build Docker image from sources'

inputs:
  image:
    description: 'Name and tag for the image to be built'
    required: true
  path:
    description: 'Build path for Docker (default: .)'
    required: true
    default: '.'
  dockerfile:
    description: 'Name of Dockerfile'
    required: true
    default: 'Dockerfile'
  args:
    description: 'Additional arguments for Docker build. (eg. --build-arg NAME="NAME")'
    required: true
    default: ''
  timeout:
    description: 'Timeout for the build process'
    required: true
    default: 120

outputs:
  image-id:
    description: 'Docker Image ID for the image'
    value: ''

runs:
  using: composite
  timeout-minutes: "{{ inputs.timeout }}"
  steps:
    - id: docker-build
      name: 'Build new image'
      run: docker build --label "org.opencontainers.image.revision=${{ github.sha }}" -f "${{ inputs.path }}/${{ inputs.dockerfile }}" ${{ inputs.args }} --cache-from "${{ inputs.image }}" --tag "${{ inputs.image }}" "${{ inputs.path }}"
      shell: bash
